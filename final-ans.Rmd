---
title: "110-1-r4ds Midterm"
params:
  name: "林木木"
  id: "007"
---


**Please change 林木木 to your name, and 007 to your school id.**

# Part I: MCQ (full mark is 70)

```{r}
browseURL("https://docs.google.com/forms/d/e/1FAIpQLSdr8n9MCsYei_1uApletwgRCDY49U6DOU6Lw7rtvYrU0-JGkA/viewform?usp=sf_link")
```


# Part II: Programming Question (Full mark is 36)
One big question with 4 small questions. Each is worth 9 points. 

## Before you start

Each question is framed like:

Create an object named **practice** and bind a numeric value of 5 to it.
```{r ans0}
# practice
```

  * **All program lines must be inside a corresponding code chunk with code chunk label `ansXX`, like the one `ans0` above**. (程式碼請寫在每小題如上帶有`ansXX`標籤的code chunk裡)
  
  * **Keep `# practice` at the very last line inside your code chunk. You can remove # if you want, but it must be the last line**. (code chunk的最後一行請保留為`# xxx`，即原始code chunk所附帶的`# xxx`)
  
  * **To check whether your answer is correct, we will run the lines in that code chunk, then do a name call on the very-last-line object (i.e. practice here)** (so you better do a name call in console on the very-last-line name to see if it delivers the answer value you want.) (`# xxx`中的xxx是最後答案正確與否的依據，所以完成該小題你最好執行xxx的name call來檢查你的答案值。)
  
  * **DO NOT touch the code chunk label (i.e. ans_practice here).** Computer will fail to run your codes if you touch and change it.(code chunk一開頭的`ansxxx`為code chunk label, 請不要動到它，否則會造成考卷判讀錯誤。)

## The Question 

Each question is worth 9 points with a total of 36 points

# 1 Drug

Download drug data:
```{r data1}
drug <- jsonlite::fromJSON("https://www.dropbox.com/s/dry3nvahkmcmqoi/drug.json?dl=1")
View(drug)
```

## 1.1 

Convert `發生地點` feature into a factor with levels sequence starting from the most common location all the way down to the least common location (levels次序由最多毒品破獲件數的地點開始到最小件數的地點結束)

```{r ans11}
table(drug$發生地點) |> sort(decreasing = T) |>
  names() -> .levels
drug$發生地點 <- factor(drug$發生地點, levels=.levels)

# drug$發生地點
```

## 1.2

For `發生地點` in "新北市中和區", based on `發生場所一` what is the most commonly observed venue (最常見的毒品發生場所)? Save the value to the object `top1place`

```{r ans12}
pick <- drug$發生地點 == "新北市中和區"
subsample <- drug[pick, ]
subsample$發生場所一 |> table() |> sort(decreasing = T) |> names() -> .tb_rank
.tb_rank[[1]] -> top1place

# top1place
```



## 1.3

Continue from 1.2, in "新北市中和區" for the most commonly observed venue (最常見的毒品發生場所) what is the average weight for each drug item? Save the values as a named numeric vector in `averageWeight`, the element names of which are drug item names.
(新北市中和區最常見的毒品發生場所裡，各毒品品項查獲的平均重量分別是多少？ 結果存在`averageWeight`數值向量裡，向量內的每個元素皆以對應毒品品項命名。)

```{r ans13}
pick2 <- subsample$發生場所一 == top1place
subsample2 <- subsample[pick2, ]
subsample2$`數量（淨重）_克` <-
  as.numeric(subsample2$`數量（淨重）_克`)
subsample2 |> 
  split(subsample2$毒品品項) -> list_dfs
averageWeight <- vector("numeric", length(list_dfs))
for(.x in seq_along(list_dfs)){
  list_dfs[[.x]]$`數量（淨重）_克` |> 
    mean(na.rm=T) -> averageWeight[[.x]]
}
names(averageWeight) <- names(list_dfs)

# averageWeight
```


## 1.4

This question is NOT limited to 最常見的毒品發生場所 from the previous question. It's a totally new question, not continued from the previous.

In "新北市中和區", for each year (`發生西元年`) and each drug item (`毒品品項`), what is the average weights of the drug confiscated? Save the values as a named numeric vector in `averageWeight2`, the element names of which are in year:drug pattern (for example, if average weight value is about 苯巴比妥 in 2019, then the element name will be "2019:苯巴比妥"). (Hint: factor interaction, split, for loop.)

```{r ans14}
factor(subsample$發生西元年):factor(subsample$毒品品項) -> .yearXitem

subsample |> split(.yearXitem) -> list_dfs
averageWeight2 <- vector("numeric", length(list_dfs))
for(.x in seq_along(list_dfs)){
  list_dfs[[1]]$`數量（淨重）_克` |> as.numeric() |>
    mean(na.rm=T) ->  averageWeight2[[.x]]
}
names(averageWeight2) <- names(list_dfs)

# averageWeight2
```

